!function(){var b,c,e,f,g,d=function(a,b){var d,o,q,r,s,t,u,v,x,i,j,k,l,m,n,p,w,y,z,A,B;if("function"==typeof document.addEventListener||f.isIE8()){d=!1;try{d=a instanceof Element}catch(h){d=!!a&&1===d.nodeType}for(d||"string"==typeof a||(b=a),i=this,j=i.classes,k=i.settings=f.merge(i.defaults,{attachTo:a},b||{}),l=i.container=f.make("div",{"class":j.container}),m=i.calendars=[],n=c().day(k.weekStart),p=[],w=[],y=0,z=k.months,f.isIE8()&&f.addClassName(l,"ie8"),y=7;y--;)p.push(n.format(k.columnHeaderFormat)),n.add(1,"days");if(g(i),"object"==typeof k.subscribe)for(y in k.subscribe)k.subscribe.hasOwnProperty(y)&&i.subscribe(y,k.subscribe[y]);for(i._sel=[],k.selected&&i.setSelected(k.selected,!1),o=k.viewStartDate?c(k.viewStartDate,k.format):i._sel.length>0?c(i._sel[0]):c(),i.viewStartDate=o.date(1),A={past:k.months-1,"today-past":k.months-1,any:k.months>2?Math.floor(k.months/2):0,"today-future":0,future:0}[this.settings.direction],A&&c().month()==c(i.viewStartDate).month()&&(i.viewStartDate=c(i.viewStartDate).subtract({M:A}).date(1)),"function"==typeof k.blackout?i.blackout=k.blackout:k.blackout?(B=e(k.blackout,k.parseSplitDelimiter,k.format),i.blackout=function(a){if(a=c(a).startOf("day").yearDay(),1>a||!i._sel)return!1;for(var b=B.length;b--;)if(B[b].startOf("day").yearDay()===a)return!0;return!1}):i.blackout=function(){return!1},i.direction=i.directions[k.direction]?i.directions[k.direction]:i.directions["any"],z=Math.max(k.months,1);z--;){q=f.make("div",{"class":j.calendar},l),q.setAttribute("data-cal-index",z),k.months>1&&(z==Math.max(k.months-1,1)?f.addClassName(q,j.monthFirst):0===z?f.addClassName(q,j.monthLast):f.addClassName(q,j.monthMiddle)),r=f.make("div",{"class":j.title},q),k.useYearNav||f.addClassName(r,j.disableYearNav),f.make("a",{"class":j.previousYear},r),f.make("a",{"class":j.previousMonth},r),f.make("a",{"class":j.nextYear},r),f.make("a",{"class":j.nextMonth},r),s=f.make("span",{"class":j.caption},r),t=f.make("div",{"class":j.header},q),y=0;do x=f.make("span",{},t),x.innerHTML=p[y];while(++y<7);u=f.make("div",{"class":j.days},q),y=0,w=[];do"week"==k.mode?(0===y%7&&(v=f.make("div",{"class":j.week+" clearfix"},u),w.push(v)),f.make("span",{},v)):w.push(f.make("span",{},u));while(++y<42);m.push({caption:s,days:w})}i.draw(),f.addEvent(l,"mousedown",function(a,b){var d;if(f.hasClassName(b,j.nextMonth))return i.disableNext||i.publish("view-changed",i,["next-month"])===!1||(i.viewStartDate.add(1,"months"),i.draw()),!1;if(f.hasClassName(b,j.previousMonth))return i.disablePreviousMonth||i.publish("view-changed",i,["previous-month"])===!1||(i.viewStartDate.subtract("months",1),i.draw()),!1;if(f.hasClassName(b,j.nextYear))return i.disableNext||i.publish("view-changed",i,["next-year"])===!1||(i.viewStartDate.add(1,"years"),i.draw()),!1;if(f.hasClassName(b,j.previousYear))return i.disablePreviousMonth||i.publish("view-changed",i,["previous-year"])===!1||(i.viewStartDate.subtract("years",1),i.draw()),!1;if((f.hasClassName(b.parentNode,j.days)||f.hasClassName(b.parentNode,j.week))&&f.hasClassName(b,j.dayActive)&&(d=b.getAttribute("data-date"))){if(d=c(d,k.dayAttributeFormat).hours(12),i.publish("date-clicked",i,[d])!==!1)switch(k.mode){case"multiple":i.addSelected(d)||i.removeSelected(d);break;case"range":i.addSelected(d);break;case"week":i.weekSelected(d);break;case"single":default:i.addSelected(d)}return!1}return f.hasClassName(b.parentNode,j.week)&&(d=b.getAttribute("data-date"))?(d=c(d,k.dayAttributeFormat).hours(12),i.publish("date-clicked",i,[d])!==!1&&"week"==k.mode&&i.weekSelected(d),!1):!1}),(k.attachTo=f.$(k.attachTo))&&k.attachTo.appendChild(l)}};if(d.prototype={defaults:{attachTo:null,months:1,weekStart:0,direction:"any",directionScrolling:!0,viewStartDate:null,blackout:null,selected:null,mode:"single",dayOutOfMonthClickable:!1,format:null,subscribe:null,columnHeaderFormat:"dd",titleFormat:"YYYY年 MMMM ",dayNumberFormat:"D",dayAttributeFormat:"YYYY-MM-DD",parseSplitDelimiter:/,\s*|\s+-\s+/,rangeDelimiter:" 至 ",multipleDelimiter:", ",useYearNav:!0,dateClassMap:{}},classes:{container:"kalendae",calendar:"k-calendar",monthFirst:"k-first-month",monthMiddle:"k-middle-month",monthLast:"k-last-month",title:"k-title",previousMonth:"k-btn-previous-month",nextMonth:"k-btn-next-month",previousYear:"k-btn-previous-year",nextYear:"k-btn-next-year",caption:"k-caption",header:"k-header",days:"k-days",week:"k-week",dayOutOfMonth:"k-out-of-month",dayInMonth:"k-in-month",dayActive:"k-active",daySelected:"k-selected",daySelectedFirst:"k-selected-first",daySelectedLast:"k-selected-last",dayInRange:"k-range",dayToday:"k-today",disablePreviousMonth:"k-disable-previous-month-btn",disableNextMonth:"k-disable-next-month-btn",disablePreviousYear:"k-disable-previous-year-btn",disableNextYear:"k-disable-next-year-btn",disableYearNav:"k-disable-year-nav"},disablePreviousMonth:!1,disableNextMonth:!1,disablePreviousYear:!1,disableNextYear:!1,directions:{past:function(a){return c(a).startOf("day").yearDay()>=b.yearDay()},"today-past":function(a){return c(a).startOf("day").yearDay()>b.yearDay()},any:function(){return!1},"today-future":function(a){return c(a).startOf("day").yearDay()<b.yearDay()},future:function(a){return c(a).startOf("day").yearDay()<=b.yearDay()}},getSelectedAsDates:function(){for(var a=[],b=0,c=this._sel.length;c>b;b++)a.push(this._sel[b].toDate());return a},getSelectedAsText:function(a){for(var b=[],c=0,d=this._sel.length;d>c;c++)b.push(this._sel[c].format(a||this.settings.format||"YYYY-MM-DD"));return b},getSelectedRaw:function(){for(var a=[],b=0,d=this._sel.length;d>b;b++)a.push(c(this._sel[b]));return a},getSelected:function(a){var b=this.getSelectedAsText(a);switch(this.settings.mode){case"week":case"range":return b.splice(2),b.join(this.settings.rangeDelimiter);case"multiple":return b.join(this.settings.multipleDelimiter);case"single":default:return b[0]||null}},isSelected:function(a){var b,d,e;if(a=c(a).startOf("day").yearDay(),1>a||!this._sel||this._sel.length<1)return!1;switch(this.settings.mode){case"week":case"range":return b=this._sel[0]?this._sel[0].startOf("day").yearDay():0,d=this._sel[1]?this._sel[1].startOf("day").yearDay():0,0==d&&b===a?1:b>d&&b===a?3:b>d&&d===a?2:d>b&&b===a?2:d>b&&d===a?3:b===a||d===a?1:b&&d?a>b&&d>a||d>b&&b>a&&a>d?-1:!1:0;case"multiple":for(e=this._sel.length;e--;)if(this._sel[e].startOf("day").yearDay()===a)return!0;return!1;case"single":default:return this._sel[0]&&this._sel[0].startOf("day").yearDay()===a}return!1},setSelected:function(a,b){var d,f=e(a,this.settings.parseSplitDelimiter,this.settings.format),g=e(this.getSelected(),this.settings.parseSplitDelimiter,this.settings.format);for(d=g.length;d--;)this.removeSelected(g[d],!1);for(d=f.length;d--;)this.addSelected(f[d],!1);b!==!1&&(f[0]&&(this.viewStartDate=c(f[0],this.settings.format)),this.draw())},addSelected:function(a,b){switch(a=c(a,this.settings.format).hours(12),this.settings.dayOutOfMonthClickable&&"range"!==this.settings.mode&&this.makeSelectedDateVisible(a),this.settings.mode){case"multiple":if(this.isSelected(a))return!1;this._sel.push(a);break;case"range":1!==this._sel.length?this._sel=[a]:a.startOf("day").yearDay()>this._sel[0].startOf("day").yearDay()?this._sel[1]=a:this._sel=[a,this._sel[0]];break;case"single":default:this._sel=[a]}return this._sel.sort(function(a,b){return a.startOf("day").yearDay()-b.startOf("day").yearDay()}),this.publish("change",this,[a]),b!==!1&&this.draw(),!0},weekSelected:function(a){var b=a.toDate(),d=c(b).startOf("week"),e=c(b).endOf("week").subtract("day",1);this._sel=[d,e],this.publish("change",this,[a.day()]),this.draw()},makeSelectedDateVisible:function(a){outOfViewMonth=c(a).date("1").diff(this.viewStartDate,"months"),0>outOfViewMonth?this.viewStartDate.subtract("months",1):outOfViewMonth>0&&outOfViewMonth>=this.settings.months&&this.viewStartDate.add(1,"months")},removeSelected:function(a,b){a=c(a,this.settings.format).hours(12);for(var d=this._sel.length;d--;)if(this._sel[d].startOf("day").yearDay()===a.startOf("day").yearDay())return this._sel.splice(d,1),this.publish("change",this,[a]),b!==!1&&this.draw(),!0;return!1},draw:function(){var d,g,h,i,n,o,p,r,s,a=c(this.viewStartDate).startOf("day").hours(12),e=this.classes,j=0,l=0,q=this.settings,k=this.calendars.length;do{d=c(a).date(1),d.day(d.day()<this.settings.weekStart?this.settings.weekStart-7:this.settings.weekStart),g=this.calendars[j],g.caption.innerHTML=a.format(this.settings.titleFormat),l=0,n=0;do"week"==q.mode?(0===l%7&&0!==l&&n++,h=g.days[n].childNodes[l%7]):h=g.days[l],i=[],o=this.isSelected(d),o&&i.push({"-1":e.dayInRange,1:e.daySelected,"true":e.daySelected,2:e.daySelectedFirst,3:e.daySelectedLast}[o]),d.month()!=a.month()?i.push(e.dayOutOfMonth):i.push(e.dayInMonth),(!(this.blackout(d)||this.direction(d)||d.month()!=a.month()&&q.dayOutOfMonthClickable===!1)||o>0)&&i.push(e.dayActive),d.startOf("day").yearDay()===b.yearDay()&&i.push(e.dayToday),p=d.format(this.settings.dayAttributeFormat),q.dateClassMap[p]&&i.push(q.dateClassMap[p]),h.innerHTML=d.format(q.dayNumberFormat),h.className=i.join(" "),h.setAttribute("data-date",p),d.add(1,"days");while(++l<42);a.add(1,"months")}while(++j<k);q.directionScrolling&&(s=c().startOf("day").hours(12),r=a.diff(s,"months",!0),"today-past"===q.direction||"past"===q.direction?0>=r?(this.disableNextMonth=!1,f.removeClassName(this.container,e.disableNextMonth)):(this.disableNextMonth=!0,f.addClassName(this.container,e.disableNextMonth)):("today-future"===q.direction||"future"===q.direction)&&(r>q.months?(this.disablePreviousMonth=!1,f.removeClassName(this.container,e.disablePreviousMonth)):(this.disablePreviousMonth=!0,f.addClassName(this.container,e.disablePreviousMonth))),"today-past"===q.direction||"past"===q.direction?-11>=r?(this.disableNextYear=!1,f.removeClassName(this.container,e.disableNextYear)):(this.disableNextYear=!0,f.addClassName(this.container,e.disableNextYear)):("today-future"===q.direction||"future"===q.direction)&&(r>11+q.months?(this.disablePreviousYear=!1,f.removeClassName(this.container,e.disablePreviousYear)):(this.disablePreviousYear=!0,f.addClassName(this.container,e.disablePreviousYear))))}},e=function(a,b,d){var i,g,h,e=[];"string"==typeof a?a=a.split(b):f.isArray(a)||(a=[a]),g=a.length,h=0;do a[h]&&(i=c(a[h],d).hours(12),i.isValid()&&e.push(i));while(++h<g);return e},window.Kalendae=d,f=d.util={isIE8:function(){return!(!/msie 8./i.test(navigator.appVersion)||/opera/i.test(navigator.userAgent)||!window.ActiveXObject||!XDomainRequest||window.msPerformance)},$:function(a){return"string"==typeof a?document.getElementById(a):a},$$:function(a){return document.querySelectorAll(a)},make:function(a,b,c){var d,e=document.createElement(a);if(b)for(d in b)b.hasOwnProperty(d)&&e.setAttribute(d,b[d]);return c&&c.appendChild(e),e},isVisible:function(a){return a.offsetWidth>0||a.offsetHeight>0},getStyle:function(a,b){var c,d;return a.currentStyle?c=a.currentStyle[b]:window.getComputedStyle&&(d=window.getComputedStyle(a,null),c=d?d[b]:""),c},domReady:function(a){var b=document.readyState;"complete"===b||"interactive"===b?a():setTimeout(function(){f.domReady(a)},9)},addEvent:function(a,b,c){var d=function(b){var d,e;return b=b||window.event,d=b.target||b.srcElement,e=c.apply(a,[b,d]),e===!1&&(b.preventDefault?b.preventDefault():(b.returnValue=!1,b.cancelBubble=!0)),e};return a.attachEvent?a.attachEvent("on"+b,d):a.addEventListener(b,d,!1),d},removeEvent:function(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)},fireEvent:function(a,b){if(document.createEvent){var c=document.createEvent("HTMLEvents");c.initEvent(b,!1,!0),a.dispatchEvent(c)}else document.createEventObject?a.fireEvent("on"+b):"function"==typeof a["on"+b]&&a["on"+b]()},hasClassName:function(a,b){if(!(a=f.$(a)))return!1;var c=a.className;return c.length>0&&(c==b||new RegExp("(^|\\s)"+b+"(\\s|$)").test(c))},addClassName:function(a,b){(a=f.$(a))&&(f.hasClassName(a,b)||(a.className+=(a.className?" ":"")+b))},removeClassName:function(a,b){(a=f.$(a))&&(a.className=f.trimString(a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ")))},isFixed:function(a){do if("fixed"===f.getStyle(a,"position"))return!0;while(a=a.offsetParent);return!1},scrollContainer:function(a){do{var b=f.getStyle(a,"overflow");if("auto"===b||"scroll"===b)return a}while((a=a.parentNode)&&a!=window.document.body);return null},getPosition:function(a,b){var c=a.offsetLeft,d=a.offsetTop,e={};if(!b)for(;a=a.offsetParent;)c+=a.offsetLeft,d+=a.offsetTop;return e[0]=e.left=c,e[1]=e.top=d,e},getHeight:function(a){return a.offsetHeight||a.scrollHeight},getWidth:function(a){return a.offsetWidth||a.scrollWidth},trimString:function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},merge:function(){for(var a=arguments[0]===!0,b={},c=a?1:0,d=function(b,c){if("object"==typeof c){for(var d in c)c.hasOwnProperty(d)&&(a&&"object"==typeof b[d]&&"object"==typeof c[d]?_update(b[d],c[d]):b[d]=c[d]);return b}};c<arguments.length;c++)d(b,arguments[c]);return b},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)}},"function"==typeof document.addEventListener&&d.util.domReady(function(){for(var c,e,g,a=f.$$(".auto-kal"),b=a.length;b--;)c=a[b],g=c.getAttribute("data-kal"),e=null==g||""==g?{}:new Function("return {"+g+"};")(),"INPUT"===c.tagName?new d.Input(c,e):new d(f.merge(e,{attachTo:c}))}),d.Input=function(a,b){var e,g,c,h,i,j,k,l,m,n;if("function"==typeof document.addEventListener||f.isIE8()){if(c=this.input=f.$(a),h=!1,!c||"INPUT"!==c.tagName)throw"First argument for Kalendae.Input must be an <input> element or a valid element id.";i=this,j=i.classes,k=i.settings=f.merge(i.defaults,b),this._events={},k.attachTo=window.document.body,k.selected?e=!0:k.selected=c.value,d.call(i,k),k.closeButton&&(g=f.make("a",{"class":j.closeButton},i.container),f.addEvent(g,"click",function(){c.blur()})),e&&(c.value=i.getSelected()),l=i.container,m=!1,l.style.display="none",f.addClassName(l,j.positioned),this._events.containerMouseDown=f.addEvent(l,"mousedown",function(){m=!0}),this._events.documentMousedown=f.addEvent(window.document,"mousedown",function(){m=!1}),this._events.inputFocus=f.addEvent(c,"focus",function(){h=!0,i.setSelected(this.value),h=!1,i.show()}),this._events.inputBlur=f.addEvent(c,"blur",function(){m&&f.isIE8()?(m=!1,c.focus()):i.hide()}),this._events.inputKeyup=f.addEvent(c,"keyup",function(){h=!0,i.setSelected(this.value),h=!1}),n=f.scrollContainer(c),n&&f.addEvent(n,"scroll",function(){c.blur()}),i.subscribe("change",function(){h||(c.value=i.getSelected(),f.fireEvent(c,"change"))})}},d.Input.prototype=f.merge(d.prototype,{defaults:f.merge(d.prototype.defaults,{format:"YYYY-MM-DD",side:"bottom",closeButton:!0,offsetLeft:0,offsetTop:0}),classes:f.merge(d.prototype.classes,{positioned:"k-floating",closeButton:"k-btn-close"}),show:function(){var a=this.container,b=a.style,c=this.input,d=f.getPosition(c),e=f.scrollContainer(c),g=e?e.scrollTop:0,h=this.settings;switch(b.display="",h.side){case"left":b.left=d.left-f.getWidth(a)+h.offsetLeft+"px",b.top=d.top+h.offsetTop-g+"px";break;case"right":b.left=d.left+f.getWidth(c)+"px",b.top=d.top+h.offsetTop-g+"px";break;case"top":b.left=d.left+h.offsetLeft+"px",b.top=d.top-f.getHeight(a)+h.offsetTop-g+"px";break;case"bottom":default:b.left=d.left+h.offsetLeft+"px",b.top=d.top+f.getHeight(c)+h.offsetTop-g+"px"}b.position=f.isFixed(c)?"fixed":"absolute",this.publish("show",this)},hide:function(){this.container.style.display="none",this.publish("hide",this)},destroy:function(){var a=this.container,b=this.input;f.removeEvent(a,"mousedown",this._events.containerMousedown),f.removeEvent(window.document,"mousedown",this._events.documentMousedown),f.removeEvent(b,"focus",this._events.inputFocus),f.removeEvent(b,"blur",this._events.inputBlur),f.removeEvent(b,"keyup",this._events.inputKeyup),a.remove()}}),g=function(a){a||(a=this);var b=a.c_||{};a.publish=function(a,c,d){for(var g,e=b[a],f=e?e.length:0;f--;)if(g=e[f].apply(c,d||[]),"boolean"==typeof g)return g},a.subscribe=function(a,c,d){return b[a]||(b[a]=[]),d?b[a].push(c):b[a].unshift(c),[a,c]},a.unsubscribe=function(a){for(var c=b[a[0]],d=a[1],e=c?c.length:0;e--;)c[e]===d&&c.splice(e,1)}},!d.moment){if(!window.moment)throw"Kalendae requires moment.js. You must use kalendae.standalone.js if moment is not available on the page.";d.moment=window.moment}c=d.moment,c.fn.yearDay=function(a){var b=Math.floor(this._d/864e5);return"undefined"==typeof a?b:this.add({d:a-b})},b=d.moment().startOf("day"),"undefined"==typeof jQuery||"function"!=typeof document.addEventListener&&!f.isIE8()||(jQuery.fn.kalendae=function(a){return this.each(function(b,c){"INPUT"===c.tagName?$(c).data("kalendae",new d.Input(c,a)):$(c).data("kalendae",new d($.extend({},{attachTo:c},a)))}),this})}();